<!DOCTYPE html>
<html lang="nl">
  <head>
    <title>Watoetoe</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
      body {
        padding: 0;
        margin: 0;
        font-family: 'Gill Sans', 'Gill Sans MT', Calibri, 'Trebuchet MS', sans-serif;
      }
    </style>
    <script>
      class HTMLAppElement extends HTMLElement {
        constructor() {
          super();
          this.attachShadow({mode: 'open'});
          this.shadowRoot.innerHTML = `
            <style>
              :host {
                display: grid;
                grid-template-rows: 1fr;
                grid-template-columns: 1fr;
                grid-template-areas: 
                  "carousel"
                  "controls";
                height: 100dvh;
                background-color: #FFF5F5;
              }

              wtt-carousel {
                grid-area: carousel;
                background-color: red;
              }

              wtt-controls {
                grid-area: controls;
                background-color: green;
              }

              wtt-wheel {
                grid-column: 1;
                grid-row: 1;
              }

              h1 {
                grid-column: 1;
                grid-row: 1;
                align-self: end;
                justify-self: center;
              }
            </style>
            <wtt-wheel>
              <slot></slot>
            </wtt-wheel>
            <h1>WATOETOE?!</h1>
          `;

          // <wtt-carousel>
          //   <slot></slot>
          // </wtt-carousel>

        }

        connectedCallback() {
          const carousel = this.shadowRoot.querySelector('wtt-carousel');
          const controls = this.shadowRoot.querySelector('wtt-controls');
          
          // controls.addEventListener('choose', () => {
          //   carousel.spin();
          // });

          // carousel.addEventlistener('scroll', () => {
          //   console.log('scroll');
          // });

          // carousel.addEventListener('stop', () => {

          // });
        }
      }
      
      class HTMLIdeaElement extends HTMLElement {
        constructor() {
          super();
          this.attachShadow({mode: 'open'});
        }

        connectedCallback() {
          this.shadowRoot.innerHTML = `
            <style>
              :host {
                display: block;
                padding: 10px;
              }

              .idea {
                color: grey;
                mix-blend-mode: difference;
              }
            </style>
            <div class="idea">
              <h2>${this.getAttribute('name')}</h2>
              <p>${this.getAttribute('description')}</p>
              <p>${this.getAttribute('weather')}</p>
              <p>${this.getAttribute('duration')}</p>
              <p>${this.getAttribute('location')}</p>
            </div>
          `;
        }
      }
      
      class SvgWheelRenderer {
        items = [{
          fill: 'red', 
          stroke: 'blue'
        }];

        radius = 50;

        constructor(items) {
          this.items = items;
        }

        /**
         * Renders the wheel
         */
        render() {
          const size = this.radius * 2;
          
          const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
          svg.setAttribute('viewBox', `0 0 ${size} ${size}`);
          
          for (const item of this.items) {
            const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
            this.#setPathData(path, item);
            this.#setPathColors(path, item);
            svg.appendChild(path);
          }

          return svg;
        }

        /**
         * Returns a path element for a single part of the wheel
         * @param {SvgPathElement} path The path element to set the data on
         * @param {HTMLIdeaElement} the element create the path for
         */
         #setPathData(path, item) {
          const radius = this.radius - 1;
          const i = this.items.indexOf(item);
          const centerX = this.radius;
          const centerY = this.radius;

          const numItems = this.items.length;
          const anglePerSegment = 2 * Math.PI / numItems;
          const isEven = numItems % 2 === 0;

          const angleDown = 3 * Math.PI / 2
          const startAngleOffset = (isEven)
            ?  angleDown - anglePerSegment / 2 
            :  angleDown;

          const startAngle = startAngleOffset + (i * anglePerSegment);
          const endAngle = startAngle + anglePerSegment;

          const startX = centerX + radius * Math.cos(startAngle);
          const startY = centerY + radius * Math.sin(startAngle);
          const endX = centerX + radius * Math.cos(endAngle);
          const endY = centerY + radius * Math.sin(endAngle);

          const largeArcFlag = (endAngle - startAngle) > Math.PI ? 1 : 0;

          const d = [
            `M ${startX} ${startY}`,               // Move to start point
            `A ${radius} ${radius} 0 ${largeArcFlag} 1 ${endX} ${endY}`, // Draw the arc
            `L ${centerX} ${centerY}`,             // Line to the center
            'Z'                                    // Close the path
          ].join(' ');

          path.setAttribute('d', d);
        }

        /**
         * Returns a path element for a single part of the wheel
         * @param {SvgPathElement} path The path element to set the colors on
         * @param {HTMLIdeaElement} the element to get the colors from
         */
        #setPathColors(path, item) {
          const i = this.items.indexOf(item);
          path.setAttribute('fill', item.fill);
          path.setAttribute('stroke', item.stroke);
        }
      }

      class HTMLWheelElement extends HTMLElement {
        constructor() {
          super();
          this.attachShadow({mode: 'open'});
          this.shadowRoot.innerHTML = `
            <style>
              :host {
                display: block;
                overflow: hidden;
              }

              ::slotted(*) {
                display: none; /* Don't render the ideas */
              }

              svg {
                /* height: 100%; */
                /* width: 100%; */
                
                translate: 0 -50%;
                scale: 2;
                
                rotate: calc(1 / var(--num-children, 1)  * 1turn);
              }

              @keyframes spin {
                from {rotate: 0turn;}
                to {rotate: 2.2turn;}
              }
            </style>
          ` + 
          `<slot></slot>` +
          `<svg></svg>`;

          this.shadowRoot.querySelector('slot').addEventListener('slotchange', (e) => {
            const slot = this.shadowRoot.querySelector('slot');
            const items = slot.assignedElements({ flatten: true });
            const wheel = new SvgWheelRenderer(items.map(item => ({
              fill: item.style.backgroundColor,
              stroke: 'transparent'
            })));
            this.shadowRoot.querySelector('svg').replaceWith(wheel.render());
            this.shadowRoot.querySelector('svg').style.setProperty('--num-children', items.length);
          });
        }

        connectedCallback() {
          this.addEventListener('click', () => {
            this.spin();
          });
        }

        spin() {
          const time = 2000;
          const svg = this.shadowRoot.querySelector('svg');
          svg.style.animation = ``;
          requestAnimationFrame(() => {
            svg.style.animation = `spin ${time}ms ease-in-out forwards`;
          });
        }
      }

      customElements.define("wtt-app", HTMLAppElement);
      customElements.define("wtt-idea", HTMLIdeaElement);
      customElements.define("wtt-wheel", HTMLWheelElement);

    </script>
  </head>
  <body>
    <wtt-app>
      <wtt-idea
        name="Idee 1"
        description="Dit is een beschrijving van idee 1"
        weather="ðŸŒžðŸŒ§ï¸"
        duration="1h-2h"
        location="Oude Kuringerbaan 1, 3500 Hasselt"
        style="background-color: lightseagreen;"
      ></wtt-idea>
      <wtt-idea
        name="Idee 2"
        description="Dit is een beschrijving van idee 2"
        weather="ðŸŒžðŸŒ§ï¸ðŸŒ¥ï¸"
        duration="2h-4h"
        location="Oude Kuringerbaan 1, 3500 Hasselt"
        style="background-color: steelblue;"
      ></wtt-idea>
      <wtt-idea
        name="Idee 3"
        description="Dit is een beschrijving van idee 3"
        weather="ðŸŒžðŸŒ§ï¸ðŸŒ¥ï¸"
        duration="4h-8h"
        location="Oude Kuringerbaan 1, 3500 Hasselt"
        style="background-color: lightcoral;"
      ></wtt-idea>
      <wtt-idea
        name="Idee 4"
        description="Dit is een beschrijving van idee 4"
        weather="ðŸŒžðŸŒ§ï¸"
        duration="30m-1h"
        location="Oude Kuringerbaan 1, 3500 Hasselt"
        style="background-color: lavender;"
      ></wtt-idea>
      <wtt-idea
        name="Idee 5"
        description="Dit is een beschrijving van idee 5"
        weather="ðŸŒ§ï¸ðŸŒ¥ï¸"
        duration="1h-2h"
        location="Oude Kuringerbaan 1, 3500 Hasselt"
        style="background-color: peachpuff"
      ></wtt-idea>
    </wtt-app>
  </body>
</html>